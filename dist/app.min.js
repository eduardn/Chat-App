!function(){"use strict";angular.module("chatApp",["ui.router","firebase","ngStorage","ngEmoji","ngSanitize","ngScrollGlue"]).config(["$urlRouterProvider","$stateProvider",function(a,b){a.otherwise("/home"),b.state("home",{url:"/home",templateUrl:"components/home/home.html",controller:"HomeController"}).state("chat",{url:"/chat",params:{userKey:null},templateUrl:"components/chat/chat.html",controller:"ChatController"}).state("chat.room",{url:"/:roomName",params:{userKey:null},templateUrl:"components/chat-room/chat.room.html",controller:"ChatRoomController"})}]).run(["$emoji",function(a){a.setConfig({img_dir:"http://hassankhan.github.io/emojify.js/images/emoji"})}])}(),function(){"use strict";function a(a,b,c,d,e,f){function g(){for(var a="0123456789ABCDEF",b="#",c=0;c<6;c++)b+=a[Math.floor(16*Math.random())];return b}var h=new firebase.auth.FacebookAuthProvider;h.addScope("user_birthday"),h.addScope("user_photos"),h.addScope("user_about_me"),h.setCustomParameters({display:"popup"}),a.fblogin=function(){firebase.auth().signInWithPopup(h).then(function(a){var c=(a.credential.accessToken,a.user.providerData[0]);console.log(c),console.log("display name: ",c.displayName);var d=firebase.database().ref().child("users").push().key,e={};e["/users/"+d]=c,firebase.database().ref().update(e),b.go("chat",{userKey:d})}).catch(function(a){a.code,a.message,a.email,a.credential})},a.signOut=function(){firebase.auth().signOut().then(function(){},function(a){})},a.addButton=function(){document.getElementById("$toggleProfile").addEventListener("click",function(){[].map.call(document.querySelectorAll(".profile"),function(a){a.classList.toggle("profile--open")})})};var i=firebase.database();c.$state=b,c.$stateParams=d,a.$storage=f.$reset(),a.username="",a.usercolor=g(),console.log(a.usercolor),a.myStyle={color:g()},a.login=function(c){if(localStorage.setItem("userNameLogged",c),c){a.$storage=f.$default({loggedUsername:c,usercolor:a.usercolor});var d=firebase.database().ref().child("users").push().key,e={};e["/users/"+d]=c,firebase.database().ref().update(e),b.go("chat")}else a.loginError=!0},i.ref("/users").once("value").then(function(a){console.log(a.val())})}angular.module("chatApp").controller("HomeController",a),a.$inject=["$scope","$state","$rootScope","$stateParams","loginService","$localStorage"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){var k=f.userKey;console.log("loggedUserKey:",k);var l=firebase.database().ref("/users/"+k);l.once("value",function(b){a.loggedUser=b.val(),console.log("Logged User",a.loggedUser)}),a.hideRooms="false"===localStorage.getItem("hidenList"),console.log(a.hideRooms),a.$storage=e.$default(),a.userName=a.$storage.loggedUsername,a.loggedUser||(console.log("should redirect to login"),c.path("/home")),a.name="",a.rooms=[],a.fblogout=function(){firebase.auth().signOut().then(function(){console.log("User logged out")},function(a){})},a.logout=function(){var a=firebase.database().ref("/rooms/");a.once("value",function(a){var b=a.val();for(var c in b)for(var d in b[c].users)console.log(b[c].users[d]+d),b[c].users[d]==k&&firebase.database().ref("/rooms/"+c+"/users/"+d).remove()});var c=firebase.database().ref("/users/");c.once("value",function(a){var c=a.val();for(var d in c)c[d]==k&&(console.log(c[d]+d),firebase.database().ref("/users/"+d).remove(),b.go("home"))}),console.log("Logged out")};var m=firebase.database();a.listRooms=function(){m.ref("/rooms").on("value",function(b){a.rooms=b.val();var c=[],d=[];for(var e in a.rooms)c.push(a.rooms[e].roomName),d.push(a.rooms[e].imageUrl);a.roomsNames=[],h(function(){a.roomNames=c,a.roomImages=d},0)})},a.listRooms(),a.imagesUrls=["http://www.imarijuana.com/wp-content/uploads/2011/10/Romania-Marijuana-Laws.png","http://pix.iemoji.com/images/emoji/apple/ios-9/256/christmas-tree.png","http://icons.veryicon.com/png/Sport/Sport/Basketball.png","https://65.media.tumblr.com/avatar_ee6f82e163e3_128.png","http://pix.iemoji.com/images/emoji/apple/ios-9/256/beer-mug.png","http://pix.iemoji.com/images/emoji/apple/ios-9/256/party-popper.png","https://s-media-cache-ak0.pinimg.com/564x/36/92/52/36925231de3dea90fd0d3c8fd9510d74.jpg","http://icons.iconarchive.com/icons/visualpharm/animals/256/Panda-icon.png","http://www.iconarchive.com/download/i86393/atyourservice/service-categories/Makeup.ico"],a.saveRoomImage=function(b){console.log(b),a.roomImage=b},a.writeRoomData=function(b){var c=(a.roomNameCreate,{sender:"RoomBot",senderPhotoURL:"https://avatars1.githubusercontent.com/u/6422482?v=3&s=400",text:"Welcome to this room!"}),d=firebase.database().ref().child("rooms").child(a.roomNameCreate).child("messageObj").push().key,e={};return e["/rooms/"+a.roomNameCreate+"/roomName"]=a.roomNameCreate,e["/rooms/"+a.roomNameCreate+"/messageObj/"+d]=c,e["/rooms/"+a.roomNameCreate+"/creator"]=a.loggedUser.displayName,e["/rooms/"+a.roomNameCreate+"/imageUrl"]=a.roomImage,a.roomNameCreate=null,a.listRooms(),firebase.database().ref().update(e)},a.getCount=function(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b},a.checkUnique=function(){a.ok=!1;var b=localStorage.getItem("roomJoined");console.log(b);var c=firebase.database().ref("rooms/"+b+"/users");return c.on("value",function(b){a.ok=!1;var c=b.val();for(var d in c)a.userName==c[d]&&(a.ok=!0);return a.ok}),a.ok},a.joinRoom=function(c){if(localStorage.setItem("hidenList",!0),a.hideRooms="true"===localStorage.getItem("hidenList"),localStorage.setItem("roomJoined",c),a.checkUnique())return console.log("problem"),void(a.userInRomm=!0);console.log("here"),a.ok=!1,a.userInRomm=!1;var d={};d["/rooms/"+c+"/users/"+k]=a.loggedUser,firebase.database().ref().update(d),b.go("chat.room",{roomName:c,userKey:k})}}angular.module("chatApp").controller("ChatController",a).directive("createRoom",function(){return{templateUrl:"components/directives/createRoom.html"}}),a.$inject=["$scope","$state","$location","loginService","$localStorage","$stateParams","$firebaseObject","$timeout","$rootScope","$q"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){a.room=h.roomName,a.userKey=h.userKey;var j=firebase.database().ref("/users/"+a.userKey);j.once("value",function(c){var d=c.val();console.log(d),b(function(){a.loggedUser=d},1)}),a.roomCreator="",a.roomUsers=[];var k=a.$storage.usercolor;a.myColorStyle={color:k};var l=firebase.database(),m=[],n=a.room,o=l.ref("/rooms/"+n+"/messageObj");o.on("value",function(c){m=c.val();var d=[];for(var e in m)d.push(m[e]);b(function(){a.messages=d},1)});var p=l.ref("/rooms/"+n+"/creator");p.once("value",function(c){var d=c.val();b(function(){a.roomCreator=d},1)}),a.sendMessage=function(b){if(b){a.messages=[];var c={sender:a.loggedUser.displayName,senderPhotoURL:a.loggedUser.photoURL,text:b},d=firebase.database().ref().child("rooms").child(a.room).child("messageObj").push().key,e={};return e["/rooms/"+a.room+"/messageObj/"+d]=c,firebase.database().ref().update(e)}};var q,r=firebase.database().ref("rooms/"+a.room+"/users/");r.orderByChild("uid").on("value",function(c){console.log(c.val()),q=c.val();var d=[];a.roomUsers=[];for(var e in q){var f=q[e];d.push(f)}b(function(){a.roomUsers=d},1)}),a.leaveRoom=function(b){var d=[],e=firebase.database().ref("/rooms/"+a.room+"/users");e.once("value",function(a){d=a.val();for(var c in d)d[c]===b&&(e.child(c).remove(),console.log(c+" Removed"))}),c.go("chat",{userKey:a.userKey})},a.kick=function(b){if(a.loggedUsername==a.roomCreator){f.$broadcast("kick",{user:b});var c=[],d=firebase.database().ref("/rooms/"+a.room+"/users");d.once("value",function(a){c=a.val();for(var e in c)c[e]===b&&(d.child(e).remove(),console.log(c[e]+" Removed"))})}};var s=firebase.database().ref("rooms/"+a.room+"/users/");s.on("value",function(b){var d=b.val();console.log("Users",d),d.indexOf(a.userKey)==-1&&(console.log("You have been disconnected"),c.go("chat",{userKey:a.userKey}))})}angular.module("chatApp").directive("schrollBottom",function(){return{scope:{schrollBottom:"="},link:function(a,b){a.$watchCollection("schrollBottom",function(a){a&&$(b).scrollTop($(b)[0].scrollHeight+20)})}}}).controller("ChatRoomController",a),a.$inject=["$scope","$timeout","$state","$firebaseArray","$firebaseObject","$rootScope","$q","$stateParams","loginService"]}(),function(){"use strict";function a(){var a=this;a.fblogin=function(){firebase.auth().signInWithPopup(provider).then(function(a){var b=a.credential.accessToken;console.log(b);var c=a.user;console.log(c)}).catch(function(a){a.code,a.message,a.email,a.credential})}}angular.module("chatApp").service("loginService",a)}();