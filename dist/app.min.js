function loginService(){var a="";this.setUsername=function(b){a=b},this.getUsername=function(){return a}}!function(){"use strict";angular.module("chatApp",["ui.router","firebase","ngStorage","ngSanitize"]).config(["$urlRouterProvider","$stateProvider",function(a,b){a.otherwise("/home"),b.state("home",{url:"/home",templateUrl:"components/home/home.html",controller:"HomeController"}).state("chat",{url:"/chat",templateUrl:"components/chat/chat.html",controller:"ChatController"}).state("chat.room",{url:"/chat/:roomName",templateUrl:"components/chat-room/chat.room.html",controller:"ChatRoomController"})}])}(),function(){"use strict";function a(a,b,c,d,e,f){function g(){for(var a="0123456789ABCDEF",b="#",c=0;c<6;c++)b+=a[Math.floor(16*Math.random())];return b}a.addButton=function(){document.getElementById("$toggleProfile").addEventListener("click",function(){[].map.call(document.querySelectorAll(".profile"),function(a){a.classList.toggle("profile--open")})})};var h=firebase.database();c.$state=b,c.$stateParams=d,a.$storage=f.$reset(),a.username="",a.usercolor=g(),console.log(a.usercolor),a.myStyle={color:g()},a.login=function(c){if(c){a.$storage=f.$default({loggedUsername:c,usercolor:a.usercolor});var d=firebase.database().ref().child("users").push().key,e={};e["/users/"+d]=c,firebase.database().ref().update(e),b.go("chat")}else a.loginError=!0},h.ref("/users").once("value").then(function(a){console.log(a.val())})}angular.module("chatApp").controller("HomeController",a),a.$inject=["$scope","$state","$rootScope","$stateParams","loginService","$localStorage"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){a.addButton=function(){document.getElementById("toggleProfile").addEventListener("click",function(){[].map.call(document.querySelectorAll(".profile"),function(a){a.classList.toggle("profile--open")})})},a.hideRooms="false"===localStorage.getItem("hidenList"),console.log(a.hideRooms),a.$storage=e.$default(),a.userName=a.$storage.loggedUsername,a.userName||(console.log("should redirect to login"),c.path("/home")),a.name="",a.rooms=[],a.logout=function(){a.$storage=e.$reset(),console.log("Logged out"),b.go("home")};var k=firebase.database();a.listRooms=function(){k.ref("/rooms").on("value",function(b){a.rooms=b.val();var c=[];for(var d in a.rooms)c.push(a.rooms[d].roomName);a.roomsNames=[],h(function(){a.roomNames=c},0)})},a.listRooms(),a.writeRoomData=function(b){var c=(a.roomNameCreate,{sender:"RoomBot",text:"Welcome to the room"}),d=firebase.database().ref().child("rooms").child(a.roomNameCreate).child("messageObj").push().key,e={};return e["/rooms/"+a.roomNameCreate+"/roomName"]=a.roomNameCreate,e["/rooms/"+a.roomNameCreate+"/messageObj/"+d]=c,a.roomNameCreate=null,a.listRooms(),firebase.database().ref().update(e)},a.getCount=function(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b},a.checkUnique=function(){a.ok=!1;var b=localStorage.getItem("roomJoined");console.log(b);var c=firebase.database().ref("rooms/"+b+"/users");return c.on("value",function(b){a.ok=!1;var c=b.val();for(var d in c)a.userName==c[d]&&(a.ok=!0);return a.ok}),a.ok},a.joinRoom=function(c){if(localStorage.setItem("hidenList",!0),a.hideRooms="true"===localStorage.getItem("hidenList"),localStorage.setItem("roomJoined",c),a.checkUnique())return console.log("problem"),void(a.userInRomm=!0);console.log("here"),a.ok=!1,a.userInRomm=!1;var d=firebase.database().ref("/users/").push().key,e={};e["/rooms/"+c+"/users/"+d]=a.userName,firebase.database().ref().update(e),b.go("chat.room",{roomName:c}),a.$on("kick",function(c,d){console.log("Kick Args",d),console.log("Kick args user",d.user),a.userName===d.user&&(console.log("You have been kicked"),b.go("chat"))})}}angular.module("chatApp").controller("ChatController",a).directive("createRoom",function(){return{templateUrl:"components/directives/createRoom.html"}}),a.$inject=["$scope","$state","$location","loginService","$localStorage","$firebaseArray","$firebaseObject","$timeout","$rootScope","$q"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){a.room=h.roomName,console.log(a.room),a.roomUsers=[],a.loggedUsername=a.$storage.loggedUsername;var j=a.$storage.usercolor;a.myColorStyle={color:j};var k=firebase.database(),l=[],m=a.room,n=k.ref("/rooms/"+m+"/messageObj").limitToLast(10);n.on("value",function(c){l=c.val();var d=[];for(var e in l)d.push(l[e]);b(function(){a.messages=d},1)}),a.sendMessage=function(b){if(b){a.messages=[];var c={sender:a.userName,text:b},d=firebase.database().ref().child("rooms").child(a.room).child("messageObj").push().key,e={};return e["/rooms/"+a.room+"/messageObj/"+d]=c,firebase.database().ref().update(e)}};var o,p=firebase.database().ref("rooms/"+a.room+"/users/");p.on("value",function(c){o=c.val();var d=[];a.roomUsers=[];for(var e in o){var f=o[e];d.push(f)}b(function(){a.roomUsers=d},1)}),a.leaveRoom=function(b){var d=[],e=firebase.database().ref("/rooms/"+a.room+"/users");e.once("value",function(a){d=a.val();for(var c in d)d[c]===b&&(e.child(c).remove(),console.log(d),console.log(c+" Removed"))}),c.go("chat",{},{reload:!0})},a.kick=function(b){if("admin"==a.loggedUsername){f.$broadcast("kick",{user:b});var c=[],d=firebase.database().ref("/rooms/"+a.room+"/users");d.once("value",function(a){c=a.val();for(var e in c)c[e]===b&&(d.child(e).remove(),console.log(c[e]+" Removed"))})}};var q=firebase.database().ref("rooms/"+a.room+"/users/");q.on("value",function(b){o=b.val();var d=[];for(var e in o){var f=o[e];d.push(f)}d.indexOf(a.loggedUsername)==-1&&(console.log("You have been disconnected"),c.go("chat",{},{reload:!0}))})}angular.module("chatApp").directive("schrollBottom",function(){return{scope:{schrollBottom:"="},link:function(a,b){a.$watchCollection("schrollBottom",function(a){a&&$(b).scrollTop($(b)[0].scrollHeight)})}}}).controller("ChatRoomController",a),a.$inject=["$scope","$timeout","$state","$firebaseArray","$firebaseObject","$rootScope","$q","$stateParams","loginService"]}(),angular.module("chatApp").service("loginService",loginService);