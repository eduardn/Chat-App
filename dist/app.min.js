function ModalInstanceCtrl(a,b,c){a.user=c,console.log("ModalInstanceController user: ",a.user.displayName),this.ok=function(){b.close(a.user)},this.cancel=function(){b.dismiss("cancel")}}!function(){"use strict";angular.module("chatApp",["ui.router","ui.bootstrap","firebase","ngStorage","ngEmoji","ngSanitize","ngScrollGlue"]).config(["$urlRouterProvider","$stateProvider",function(a,b){a.otherwise("/home"),b.state("home",{url:"/home",templateUrl:"components/home/home.html",controller:"HomeController",onEnter:["loginService","$state",function(a,b){a.isLoggedIn().then(function(a){console.log(a),a&&b.go("chat")})}]}).state("chat",{url:"/chat",resolve:{loggedUser:["loginService","$state",function(a,b){return a.isLoggedIn().then(function(a){return a?a:void b.go("home")})}]},params:{userKey:null},templateUrl:"components/chat/chat.html",controller:"ChatController"}).state("chat.room",{url:"/:roomName",params:{userKey:null},templateUrl:"components/chat-room/chat.room.html",controller:"ChatRoomController"})}]).run(["$emoji","$rootScope",function(a,b){b.config={hideRooms:!1},a.setConfig({img_dir:"http://hassankhan.github.io/emojify.js/images/emoji"})}])}(),function(){"use strict";function a(a,b,c,d,e,f){function g(){for(var a="0123456789ABCDEF",b="#",c=0;c<6;c++)b+=a[Math.floor(16*Math.random())];return b}a.fblogin=function(){e.login().then(function(){b.go("chat")})},a.signOut=function(){firebase.auth().signOut().then(function(){},function(a){})},a.addButton=function(){document.getElementById("$toggleProfile").addEventListener("click",function(){[].map.call(document.querySelectorAll(".profile"),function(a){a.classList.toggle("profile--open")})})};var h=firebase.database();c.$state=b,c.$stateParams=d,a.$storage=f.$reset(),a.username="",a.usercolor=g(),console.log(a.usercolor),a.myStyle={color:g()},a.login=function(c){if(localStorage.setItem("userNameLogged",c),c){a.$storage=f.$default({loggedUsername:c,usercolor:a.usercolor});var d=firebase.database().ref().child("users").push().key,e={};e["/users/"+d]=c,firebase.database().ref().update(e),b.go("chat")}else a.loginError=!0},h.ref("/users").once("value").then(function(a){console.log(a.val())})}angular.module("chatApp").controller("HomeController",a),a.$inject=["$scope","$state","$rootScope","$stateParams","loginService","$localStorage"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){var k=d.firebaseUserKey;if(console.log("loggedUser:",d),a.loggedUser=d,null==d){var l=firebase.database().ref("/users/"+k);l.on("value",function(b){a.loggedUser=b.val(),console.log("Logged User",a.loggedUser)})}i.config.hideRooms=!1,console.log("First hide rooms: ",a.hideRooms),a.$storage=e.$default(),a.userName=a.$storage.loggedUsername,a.name="",a.rooms=[],a.fblogout=function(){firebase.auth().signOut().then(function(){var c=firebase.database().ref("/users");c.once("value",function(b){var d=b.val();console.log("All users: ",d);for(var e in d)console.log("All users key: ",d[e]),a.loggedUser.uid==d[e].uid&&(console.log("user ID matched => remove from user: ",e,d[e].displayName),c.child(e).remove())}),console.log(c);var d=firebase.database().ref("/rooms/");d.once("value",function(b){var c=b.val();console.log("usersArray: ",c);for(var d in c){console.log("ukey: ",d);for(var e in c[d].users)console.log("ukeyUser: ",e),a.loggedUser.uid==c[d].users[e].uid&&(console.log("user ID matched => remove from rooms: ",d,c[d].users[e].displayName),firebase.database().ref("/rooms/"+d+"/users/"+e).remove())}}),console.log("User logged out"),b.go("home")},function(a){})};var m=firebase.database();a.listRooms=function(){m.ref("/rooms").on("value",function(b){a.rooms=b.val();var c=[],d=[];for(var e in a.rooms)c.push(a.rooms[e].roomName),d.push(a.rooms[e].imageUrl);a.roomsNames=[],h(function(){a.roomNames=c,a.roomImages=d},0)})},a.listRooms(),console.log("hideRooms after listrooms: ",a.hideRooms),a.imagesUrls=["http://www.imarijuana.com/wp-content/uploads/2011/10/Romania-Marijuana-Laws.png","http://pix.iemoji.com/images/emoji/apple/ios-9/256/christmas-tree.png","http://icons.veryicon.com/png/Sport/Sport/Basketball.png","https://65.media.tumblr.com/avatar_ee6f82e163e3_128.png","http://pix.iemoji.com/images/emoji/apple/ios-9/256/beer-mug.png","http://pix.iemoji.com/images/emoji/apple/ios-9/256/party-popper.png","https://s-media-cache-ak0.pinimg.com/564x/36/92/52/36925231de3dea90fd0d3c8fd9510d74.jpg","http://icons.iconarchive.com/icons/visualpharm/animals/256/Panda-icon.png","http://www.iconarchive.com/download/i86393/atyourservice/service-categories/Makeup.ico"],a.saveRoomImage=function(b){console.log(b),a.roomImage=b},a.writeRoomData=function(b){var c=(a.roomNameCreate,{sender:"RoomBot",senderPhotoURL:"https://avatars1.githubusercontent.com/u/6422482?v=3&s=400",text:"Welcome to this room!"}),d=firebase.database().ref().child("rooms").child(a.roomNameCreate).child("messageObj").push().key,e={};return e["/rooms/"+a.roomNameCreate+"/roomName"]=a.roomNameCreate,e["/rooms/"+a.roomNameCreate+"/messageObj/"+d]=c,e["/rooms/"+a.roomNameCreate+"/creator"]=a.loggedUser.displayName,e["/rooms/"+a.roomNameCreate+"/imageUrl"]=a.roomImage,a.roomNameCreate=null,a.listRooms(),firebase.database().ref().update(e)},a.getCount=function(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b},a.checkUnique=function(){a.ok=!1;var b=localStorage.getItem("roomJoined");console.log(b);var c=firebase.database().ref("rooms/"+b+"/users");return c.on("value",function(b){a.ok=!1;var c=b.val();for(var d in c)a.userName==c[d]&&(a.ok=!0);return a.ok}),a.ok},a.joinRoom=function(c){if(i.config.hideRooms=!0,localStorage.setItem("roomJoined",c),a.checkUnique())console.log("problem"),a.userInRomm=!0;else{console.log("here"),a.ok=!1,a.userInRomm=!1;var d={};d["/rooms/"+c+"/users/"+k]=a.loggedUser,firebase.database().ref().update(d),console.log("When Join: ",a.hideRooms),b.go(".room",{roomName:c})}}}angular.module("chatApp").controller("ChatController",a).directive("createRoom",function(){return{templateUrl:"components/directives/createRoom.html"}}),a.$inject=["$scope","$state","$location","loggedUser","$localStorage","$stateParams","$firebaseObject","$timeout","$rootScope","$q"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){a.room=h.roomName,a.loggedUserKey=i.firebaseUserKey,a.loggedUser=i,f.config.hideRooms=!0,a.roomCreator="",a.roomUsers=[];var k=a.$storage.usercolor;a.myColorStyle={color:k};var l=firebase.database(),m=[],n=a.room,o=l.ref("/rooms/"+n+"/messageObj");o.on("value",function(c){m=c.val();var d=[];for(var e in m)d.push(m[e]);b(function(){a.messages=d},1)});var p=l.ref("/rooms/"+n+"/creator");p.once("value",function(c){var d=c.val();b(function(){a.roomCreator=d},1)}),a.sendMessage=function(b){if(b){a.messages=[];var c={sender:a.loggedUser.displayName,senderPhotoURL:a.loggedUser.photoURL,text:b},d=firebase.database().ref().child("rooms").child(a.room).child("messageObj").push().key,e={};return e["/rooms/"+a.room+"/messageObj/"+d]=c,firebase.database().ref().update(e)}};var q,r=firebase.database().ref("rooms/"+a.room+"/users/");r.orderByChild("uid").on("value",function(c){console.log(c.val()),q=c.val();var d=[];a.roomUsers=[];for(var e in q){var f=q[e];d.push(f)}b(function(){a.roomUsers=d},1)}),a.leaveRoom=function(b){f.config.hideRooms=!1;var d=[],e=firebase.database().ref("/rooms/"+a.room+"/users");e.once("value",function(b){d=b.val(),console.log("leave room users: ",d);for(var c in d)console.log("my key: ",a.loggedUserKey),console.log("current key: ",c),console.log("user key: ",d[c]),a.loggedUser.uid==d[c].uid&&(e.child(c).remove(),console.log(c+" Removed"))}),c.go("chat")},a.userDetails=function(a){console.log("User details: ",a);j.open({ariaLabeledBy:"User Details",ariaDescribedBy:"Body",windowClass:"app-modal-window",templateUrl:"components/chat-room/user-details.html",controller:"ModalInstanceCtrl",resolve:{user:function(){return a}}})},a.kick=function(b){if(console.log("kicked user: ",b),a.loggedUser.displayName==a.roomCreator){f.$broadcast("kick",{user:b});var c=[],d=firebase.database().ref("/rooms/"+a.room+"/users");d.once("value",function(a){c=a.val(),console.log("Users array: ",c);for(var e in c)console.log("cheile ",e),console.log("usersArray.userid: ",c[e]),console.log("usersArray[ukey].uid: ",c[e].uid),console.log("usersArray[ukey].displayName: ",c[e].displayName),console.log("user uid: YOLO ",b.uid,c[e].uid),c[e].uid==b.uid&&(console.log("user uid: ",b.uid,c[e].uid),console.log(c[e].displayName+" Removed"),d.child(e).remove())})}};var s=firebase.database().ref("rooms/"+a.room+"/users/");s.on("value",function(b){var d=b.val();console.log("Users",d);var e=[];for(var f in d)e.push(d[f].uid);console.log("userIDS: ",e,a.loggedUser.uid),e.indexOf(a.loggedUser.uid)==-1&&(console.log("You have been disconnected"),c.go("chat"))})}angular.module("chatApp").directive("schrollBottom",function(){return{scope:{schrollBottom:"="},link:function(a,b){a.$watchCollection("schrollBottom",function(a){a&&$(b).scrollTop($(b)[0].scrollHeight+100)})}}}).controller("ChatRoomController",a),a.$inject=["$scope","$timeout","$state","$firebaseArray","$firebaseObject","$rootScope","$q","$stateParams","loggedUser","$uibModal"]}(),function(){"use strict";function a(a){var b=this,c=new firebase.auth.FacebookAuthProvider;c.addScope("user_birthday"),c.addScope("user_photos"),c.addScope("user_about_me"),c.addScope("user_actions.books"),c.addScope("user_actions.music"),c.addScope("user_hometown"),c.addScope("user_location"),c.setCustomParameters({display:"popup"}),b.currentUser=null,b.isLoggedIn=function(){var c=a.defer();return b.currentUser?(c.resolve(b.currentUser),c.promise):(firebase.auth().onAuthStateChanged(function(a){console.log(a),a?(c.resolve(a.providerData[0]),b.currentUser=a.providerData[0]):c.resolve(null)}),c.promise)},b.login=function(){return firebase.auth().signInWithPopup(c).then(function(a){var c=a.user.providerData[0],d=firebase.database().ref().child("users").push().key,e={};return e["/users/"+d]=c,c.firebaseUserKey=d,b.currentUser=c,firebase.database().ref().update(e)}).catch(function(a){a.code,a.message,a.email,a.credential})}}angular.module("chatApp").service("loginService",["$q",a])}(),angular.module("chatApp").controller("ModalInstanceCtrl",ModalInstanceCtrl),ModalInstanceCtrl.$inject=["$scope","$uibModalInstance","user"];